<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
	</head>

	<body>
		<nav class="mui-bar mui-bar-tab">
			<a class="mui-tab-item mui-active" id="index">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" id="phone">
				<span class="mui-icon mui-icon-phone"></span>
				<span class="mui-tab-label">电话</span>
			</a>
			<a class="mui-tab-item">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">邮件</span>
			</a>
			<a class="mui-tab-item" id="login">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">设置</span>
			</a>
		</nav>
	</body>
	<script type="text/javascript" charset="utf-8">
		var ws = null;  // websocket对象
		mui.init({
			subpages: [{
				url: "main.html",
				id: "main.html",
				styles: window.styles
			}]
		});
		mui.plusReady(function() {
//			console.log(JSON.stringify(plus.webview.currentWebview()))
			if(plus.storage.getItem("user")) {  // 判断是否登录
				console.log('已结登录了！');
				//连接websocket连接
				ws = new WebSocket("ws://"+window.ws_serv+"/app/"+plus.storage.getItem("user"))
				// 客户端接收服务端数据时触发
				ws.onmessage = function() {};
			} 
		});

		document.getElementById("phone").addEventListener("tap", function() {
			mui.toast("你點擊了電話按鈕");

			mui.openWindow({
				url: "phone.html",
				id: "phone.html",
				styles: window.styles,
				extras: {
					user_id: 123456
				}
			})
		})

		document.getElementById("index").addEventListener("tap", function() {
			mui.openWindow({
				url: "main.html",
				id: "main.html",
				styles: window.styles
			})
		})

		document.getElementById("login").addEventListener("tap", function() {
			mui.openWindow({
				url: "login.html",
				id: "login.html",
				styles: window.styles
			})
		})
		
		document.addEventListener("login",function(data){
			// fire事件接收消息，使用data.detail
			// index是为做显示区分
			mui.toast("index"+data.detail.msg)
		});
		
		document.addEventListener("send_music", function(data) {  //监听send_music事件
			var music_name = data.detail.music_name;  //获取player.html使用fire发送的music_name值
			var toy_id = data.detail.toy_id;  //获取发送的玩具id
			
			send_str = {  //构造数据
				music_name:music_name,
				toy_id:toy_id
			}  
			// 发送数据给后端，注意要json序列化
			ws.send(JSON.stringify(send_str));
		});
		
	</script>

</html>